fticr_pore_gather_trtsummary_c2
# sixth, convert all columns into numeric and transform this mess into a dataframe. the mutate functions (next) will not work if it is not a dataframe. fml
fticr_pore_gather_trtsummary_c2[,3:6] = sapply(fticr_pore_gather_trtsummary_c2[,3:6], as.numeric)
fticr_pore_gather_trtsummary_c2 = data.frame(fticr_pore_gather_trtsummary_c2)
# seventh, create new columns for molecules added/lost for each treatment. subtract all treatments from baseline
### THERE ARE NO BASELINE DATA IN THIS DATASET. SO SUBTRACT TZSATURATION INSTEAD OF BASELINE.
# +1 = new molecule, -1 = lost molecule, 0 = molecule present or absent in treatment&baseline
fticr_pore_gather_trtsummary_c2 %>%
mutate(drought_new = drought - time.zero.saturation) %>%
mutate(saturation_new = saturation - time.zero.saturation) %>%
mutate(fieldmoist_new = field.moist - time.zero.saturation) ->
fticr_pore_gather_trtsummary_c2
# eighth, create a new column for unique molecules
setDT(fticr_pore_gather_trtsummary_c2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
fticr_pore_gather_trtsummary_c2[time.zero.saturation==0 & saturation==0 & drought==1 & field.moist==0, unique := "drought"]
fticr_pore_gather_trtsummary_c2[time.zero.saturation==0 & saturation==0 & drought==0 & field.moist==1, unique := "field_moist"]
# ninth, add 'site' column for when we bind later
fticr_pore_gather_trtsummary_c2$site="CPCRW"
#
setDT(fticr_pore_gather_trtsummary_d)[N>0, presence := "1"]
#
fticr_pore_gather_trtsummary_d2 = dcast(fticr_pore_gather_trtsummary_d, Mass+tension ~ treatment, value.var = "presence")
#
fticr_pore_gather_trtsummary_d2 %>%
replace(.,is.na(.),0) ->
fticr_pore_gather_trtsummary_d2
#
fticr_pore_gather_trtsummary_d2[,3:6] = sapply(fticr_pore_gather_trtsummary_d2[,3:6], as.numeric)
fticr_pore_gather_trtsummary_d2 = data.frame(fticr_pore_gather_trtsummary_d2)
#
### THERE ARE NO BASELINE DATA IN THIS DATASET. SO SUBTRACT TZSATURATION INSTEAD OF BASELINE.
# +1 = new molecule, -1 = lost molecule, 0 = molecule present or absent in treatment&baseline
fticr_pore_gather_trtsummary_d2 %>%
mutate(drought_new = drought - time.zero.saturation) %>%
mutate(saturation_new = saturation - time.zero.saturation) %>%
mutate(fieldmoist_new = field.moist - time.zero.saturation) ->
fticr_pore_gather_trtsummary_d2
#
setDT(fticr_pore_gather_trtsummary_d2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
fticr_pore_gather_trtsummary_d2[time.zero.saturation==0 & saturation==0 & drought==1 & field.moist==0, unique := "drought"]
fticr_pore_gather_trtsummary_d2[time.zero.saturation==0 & saturation==0 & drought==0 & field.moist==1, unique := "field_moist"]
#
fticr_pore_gather_trtsummary_d2$site="DWP"
#
setDT(fticr_pore_gather_trtsummary_s)[N>0, presence := "1"]
#
fticr_pore_gather_trtsummary_s2 = dcast(fticr_pore_gather_trtsummary_s, Mass+tension ~ treatment, value.var = "presence")
#
fticr_pore_gather_trtsummary_s2 %>%
replace(.,is.na(.),0) ->
fticr_pore_gather_trtsummary_s2
#
fticr_pore_gather_trtsummary_s2[,3:6] = sapply(fticr_pore_gather_trtsummary_s2[,3:6], as.numeric)
fticr_pore_gather_trtsummary_s2 = data.frame(fticr_pore_gather_trtsummary_s2)
#
### THERE ARE NO BASELINE DATA IN THIS DATASET. SO SUBTRACT TZSATURATION INSTEAD OF BASELINE.
# +1 = new molecule, -1 = lost molecule, 0 = molecule present or absent in treatment&baseline
fticr_pore_gather_trtsummary_s2 %>%
mutate(drought_new = drought - time.zero.saturation) %>%
mutate(saturation_new = saturation - time.zero.saturation) %>%
mutate(fieldmoist_new = field.moist - time.zero.saturation) ->
fticr_pore_gather_trtsummary_s2
#
setDT(fticr_pore_gather_trtsummary_s2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
fticr_pore_gather_trtsummary_s2[time.zero.saturation==0 & saturation==0 & drought==1 & field.moist==0, unique := "drought"]
fticr_pore_gather_trtsummary_s2[time.zero.saturation==0 & saturation==0 & drought==0 & field.moist==1, unique := "field_moist"]
#
fticr_pore_gather_trtsummary_s2$site="SR"
fticr_pore_new = rbind (fticr_pore_gather_trtsummary_c2,fticr_pore_gather_trtsummary_d2,fticr_pore_gather_trtsummary_s2)
## remove the presence/absence columns, they are now unnecessary
fticr_pore_new = data.frame(fticr_pore_new[,-c(3:6)])
fticr_pore_new[,3:5] = sapply(fticr_pore_new[,3:5], as.factor)
fticr_pore_new %>%
mutate(drought = case_when(
drought_new=="1"~"new",
drought_new=="-1"~"lost")) %>%
mutate(saturation = case_when(
saturation_new=="1"~"new",
saturation_new=="-1"~"lost")) %>%
mutate(field.moist = case_when(
fieldmoist_new=="1"~"new",
fieldmoist_new=="-1"~"lost"))  ->
fticr_pore_new
## subset only the character coding columns for new/lost
fticr_pore_new %>%
select("Mass","site","tension","saturation","field.moist","drought")->
fticr_pore_new2
## melt/gather into long-form. make new columns for treatment and newmolecules
fticr_pore_new2 = (fticr_pore_new2) %>%
gather(treatment, newmolecules,saturation:drought)
## remove NA
fticr_pore_new2 = fticr_pore_new2[complete.cases(fticr_pore_new2),]
fticr_pore_new3 = merge(fticr_pore_meta,fticr_pore_new2, by = "Mass")
## OUTPUT
write_csv(fticr_pore_new3, path = "fticr/fticr_pore_newmolecules.csv")
fticr_pore_unique = fticr_pore_new %>%
select("Mass","site","tension","unique")
## remove NA
fticr_pore_unique = fticr_pore_unique[complete.cases(fticr_pore_unique),]
fticr_pore_unique2 = merge(fticr_pore_meta, fticr_pore_unique, by = "Mass")
## OUTPUT
write_csv(fticr_pore_unique2, path = "fticr/fticr_pore_uniquemolecules.csv")
View(fticr_pore_unique2)
ggplot(fticr_pore_uniquemolecules[fticr_soil_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
geom_point()+
facet_wrap(~tension)+
theme_bw()+
theme(
legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW unique")
# 4d. unique molecules ----
fticr_pore_uniquemolecules = read_csv("fticr/fticr_pore_uniquemolecules.csv")
ggplot(fticr_pore_uniquemolecules[fticr_soil_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
geom_point()+
facet_wrap(~tension)+
theme_bw()+
theme(
legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW unique")
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
geom_point()+
facet_wrap(~tension)+
theme_bw()+
theme(
legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW unique")
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique:CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="DWP",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="SR",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique_c=
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique:CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique_d=
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="DWP",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique_s=
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="SR",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique = plot_grid(gg_pore_vankrev_unique_c,
gg_pore_vankrev_unique_d,
gg_pore_vankrev_unique_s,
nrow = 3, align = "hv", axis = "bt")
save_plot("output/fticr_pore_vankrev_uniquemolecules.tiff",
gg_pore_vankrev_unique, base_width = 6, base_height = 12)
source("0-packages.R")
## step 1: load and merge the files ----
# data are split into (a) metadata and (b) sample data
# read_cvs reads the zipped files without extracting
fticr_soil_meta = read_csv("data/FTICR_INPUT_SOIL_META.csv.zip")
View(fticr_soil_meta)
kmd_calc = fticr_soil_meta %>%
select(Mass,kmass,kdefect)
View(kmd_calc)
nominal_coo = 44
exact_coo = 43.989828
kmd_calc$kendrickmass = kmd_calc$Mass*nominal_coo/exact_coo
View(kmd_calc)
kmd_calc$kendrickmass2 = kmd_calc$Mass
kmd_calc$kendrickmass2 = kmd_calc$Mass*14/14.01565
View(kmd_calc)
kmd_calc$mass_integer= integer(kmd_calc$Mass)
kmd_calc$mass_integer= as.integer(kmd_calc$Mass)
View(kmd_calc)
kmd_calc$kmassdefect = kmd_calc$mass_integer-kmd_calc$Mass
View(kmd_calc)
kmd_calc$kmassdefect = kmd_calc$mass_integer-kmd_calc$kendrickmass2
View(fticr_soil_meta)
View(kmd_calc)
fticr_pore_gather2 = read_csv("fticr/fticr_pore_longform.csv")
View(fticr_pore_gather2)
View(fticr_pore_gather2)
#fticr_pore_gather2 %>%
select("core","site","treatment","tension","Mass","intensity") %>%
mutate(intensity = round(intensity,2))  ->
fticr_pore_kendrick
fticr_pore_gather2 %>%
select(core,site,treatment,tension,Mass,intensity) %>%
mutate(intensity = round(intensity,2))  ->
fticr_pore_kendrick
View(fticr_pore_kendrick)
nominal_ch2 = 14.00000
iupac_ch2 = 14.01565
fticr_pore_gather2 %>%
mutate(kmass = Mass*nominal_ch2/iupac_ch2) %>%
mutate(kmd = as.integer(Mass) - kmass) ->
fticr_pore_gather2
View(fticr_pore_gather2)
fticr_pore_kendrick %>%
mutate(kmass = Mass*nominal_ch2/iupac_ch2) %>%
mutate(kmd = as.integer(Mass) - kmass) ->
fticr_pore_kendrick
View(fticr_pore_kendrick)
View(fticr_soil_meta)
### OUTPUT
# write.csv(fticr_soil_kendrick,"fticr_soil_kendrick.csv")
write_csv(fticr_pore_kendrick,path = "fticr/fticr_pore_kendrick.csv")
## 3: plot kendrick ----
fticr_pore_kendrick = read_csv("fticr/fticr_pore_kendrick.csv")
View(fticr_pore_kendrick)
fticr_pore_kendrick %>%
mutate(treatment = factor(treatment,
levels = c("time zero saturation", "field moist","saturation","drought")))->
fticr_soil_kendrick
fticr_pore_kendrick %>%
mutate(treatment = factor(treatment,
levels = c("time zero saturation", "field moist","saturation","drought")))->
fticr_pore_kendrick
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="CPCRW",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme_bw()+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW")
View(fticr_pore_kendrick)
fticr_pore_gather2 %>%
select(core,site,treatment,tension,Mass,intensity) %>%
mutate(intensity = round(intensity,2))  ->
fticr_pore_kendrick
nominal_ch2 = 14.00000
iupac_ch2 = 14.01565
fticr_pore_kendrick %>%
mutate(kmass = Mass*nominal_ch2/iupac_ch2) %>%
mutate(kdefect = as.integer(Mass) - kmass) ->
fticr_pore_kendrick
### OUTPUT
# write.csv(fticr_soil_kendrick,"fticr_soil_kendrick.csv")
write_csv(fticr_pore_kendrick,path = "fticr/fticr_pore_kendrick.csv")
## 3: plot kendrick ----
fticr_pore_kendrick = read_csv("fticr/fticr_pore_kendrick.csv")
fticr_pore_kendrick %>%
mutate(treatment = factor(treatment,
levels = c("time zero saturation", "field moist","saturation","drought")))->
fticr_pore_kendrick
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="CPCRW",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme_bw()+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW")
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="CPCRW"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme_bw()+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW")
## 3: plot kendrick ----
fticr_pore_kendrick = read_csv("fticr/fticr_pore_kendrick.csv")
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="CPCRW"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme_bw()+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW")
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="CPCRW"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="DWP"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="SR"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("SR")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="SR"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_kendrick_c=
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="CPCRW"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_kendrick_d=
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="DWP"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_kendrick_s=
ggplot(fticr_pore_kendrick[fticr_pore_kendrick$site=="SR"&
!fticr_pore_kendrick$treatment=="time zero saturation",],
aes(x = kmass, y = kdefect, color = treatment))+
geom_point(size=0.5)+
facet_wrap(~tension)+
xlim(200,900)+
ylim(0,1)+
theme(legend.position = "top",
legend.title = element_blank())+
ggtitle("SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_kendrick = plot_grid(gg_pore_kendrick_c,
gg_pore_kendrick_d,
gg_pore_kendrick_s,
nrow = 3, align = "hv", axis = "bt")
save_plot("output/fticr_pore_kendrick.tiff", gg_pore_kendrick,
base_width = 7, base_height = 10)
save_plot("output/fticr_pore_kendrick.tiff", gg_pore_kendrick,
base_width = 7, base_height = 15)
save_plot("output/fticr_pore_vankrev_treatments.tiff", gg_pore_vankrev_combined,
base_width = 5, base_height = 10)
save_plot("output/fticr_pore_kendrick.tiff", gg_pore_kendrick,
base_width = 5, base_height = 10)
