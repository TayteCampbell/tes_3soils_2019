geom_point()+
ggtitle("new molecules: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="DWP",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
ggtitle("new molecules: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
ggtitle("new molecules: CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_newmolecules = plot_grid(gg_pore_vankrev_newmolecules_c,
gg_pore_vankrev_newmolecules_d,
gg_pore_vankrev_newmolecules_s,
nrow = 3, align = "hv", axis = "bt")
gg_pore_vankrev_newmolecules_c=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
ggtitle("new molecules: CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_newmolecules_d=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="DWP",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
ggtitle("new molecules: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_newmolecules_s=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="SR",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
ggtitle("new molecules: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_newmolecules = plot_grid(gg_pore_vankrev_newmolecules_c,
gg_pore_vankrev_newmolecules_d,
gg_pore_vankrev_newmolecules_s,
nrow = 3, align = "hv", axis = "bt")
save_plot("output/fticr_pore_vankrev_newmolecules.tiff", gg_pore_vankrev_newmolecules,
base_width = 7, base_height = 15)
save_plot("output/fticr_pore_vankrev_newmolecules.tiff", gg_pore_vankrev_newmolecules,
base_width = 7, base_height = 10)
save_plot("output/fticr_pore_vankrev_newmolecules.tiff", gg_pore_vankrev_newmolecules,
base_width = 10, base_height = 10)
save_plot("output/fticr_pore_vankrev_newmolecules.tiff", gg_pore_vankrev_newmolecules,
base_width = 7, base_height = 12)
gg_pore_vankrev_newmolecules_c=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("new molecules: CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_newmolecules_d=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="DWP",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("new molecules: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_newmolecules_s=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="new" &
fticr_pore_newmolecules$site=="SR",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("new molecules: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_newmolecules = plot_grid(gg_pore_vankrev_newmolecules_c,
gg_pore_vankrev_newmolecules_d,
gg_pore_vankrev_newmolecules_s,
nrow = 3, align = "hv", axis = "bt")
save_plot("output/fticr_pore_vankrev_newmolecules.tiff", gg_pore_vankrev_newmolecules,
base_width = 7, base_height = 12)
save_plot("output/fticr_pore_vankrev_newmolecules.tiff", gg_pore_vankrev_newmolecules,
base_width = 5, base_height = 12)
save_plot("output/fticr_pore_vankrev_newmolecules.tiff", gg_pore_vankrev_newmolecules,
base_width = 6, base_height = 12)
gg_pore_vankrev_lostmolecules_c=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="lost" &
fticr_pore_newmolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("lost molecules: CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_lostmolecules_d=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="lost" &
fticr_pore_newmolecules$site=="DWP",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("lost molecules: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_lostmolecules_s=
ggplot(
fticr_pore_newmolecules[
fticr_pore_newmolecules$newmolecules=="lost" &
fticr_pore_newmolecules$site=="SR",],
aes(x = OC, y = HC, color = treatment))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("lost molecules: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_lostmolecules = plot_grid(gg_pore_vankrev_lostmolecules_c,
gg_pore_vankrev_lostmolecules_d,
gg_pore_vankrev_lostmolecules_s,
nrow = 3, align = "hv", axis = "bt")
save_plot("output/fticr_pore_vankrev_lostmolecules.tiff", gg_pore_vankrev_lostmolecules,
base_width = 6, base_height = 12)
# 4d. unique molecules ----
fticr_pore_uniquemolecules = read_csv("fticr/fticr_pore_uniquemolecules.csv")
View(fticr_pore_uniquemolecules)
#
setDT(fticr_pore_gather_trtsummary_s2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
fticr_pore_gather_trtsummary_s2[time.zero.saturation==0 & saturation==0 & drought==1 & field.moist==0, unique := "drought"]
fticr_pore_gather_trtsummary_s2[time.zero.saturation==0 & saturation==0 & drought==0 & field.moist==1, unique := "field_moist"]
#
fticr_pore_gather_trtsummary_s2$site="SR"
# eighth, create a new column for unique molecules
setDT(fticr_pore_gather_trtsummary_c2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
# first, combine all cores within each treatment
fticr_pore_gather_trtsummary = summarySE(fticr_pore_gather2, measurevar = "intensity", groupvars = c("site", "treatment","tension", "Mass"))
# second, split the file into three, for the three sites
fticr_pore_gather_trtsummary_c = fticr_pore_gather_trtsummary[fticr_pore_gather_trtsummary$site=="CPCRW",1:5]
fticr_pore_gather_trtsummary_d = fticr_pore_gather_trtsummary[fticr_pore_gather_trtsummary$site=="DWP",1:5]
fticr_pore_gather_trtsummary_s = fticr_pore_gather_trtsummary[fticr_pore_gather_trtsummary$site=="SR",1:5]
# third, make a new column that is binary for presence (1) and absence (0). if N>0, a molecule is present
setDT(fticr_pore_gather_trtsummary_c)[N>0, presence := "1"]
# fourth, split the treatment column into five separate columns. this will make further calculations easier.
fticr_pore_gather_trtsummary_c2 = dcast(fticr_pore_gather_trtsummary_c, Mass+tension ~ treatment, value.var = "presence")
# fifth, replace all NA with 0 for subsequent subtraction
fticr_pore_gather_trtsummary_c2 %>%
replace(.,is.na(.),0) ->
fticr_pore_gather_trtsummary_c2
# sixth, convert all columns into numeric and transform this mess into a dataframe. the mutate functions (next) will not work if it is not a dataframe. fml
fticr_pore_gather_trtsummary_c2[,3:6] = sapply(fticr_pore_gather_trtsummary_c2[,3:6], as.numeric)
fticr_pore_gather_trtsummary_c2 = data.frame(fticr_pore_gather_trtsummary_c2)
# seventh, create new columns for molecules added/lost for each treatment. subtract all treatments from baseline
### THERE ARE NO BASELINE DATA IN THIS DATASET. SO SUBTRACT TZSATURATION INSTEAD OF BASELINE.
# +1 = new molecule, -1 = lost molecule, 0 = molecule present or absent in treatment&baseline
fticr_pore_gather_trtsummary_c2 %>%
mutate(drought_new = drought - time.zero.saturation) %>%
mutate(saturation_new = saturation - time.zero.saturation) %>%
mutate(fieldmoist_new = field.moist - time.zero.saturation) ->
fticr_pore_gather_trtsummary_c2
# eighth, create a new column for unique molecules
setDT(fticr_pore_gather_trtsummary_c2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
fticr_pore_gather_trtsummary_c2[time.zero.saturation==0 & saturation==0 & drought==1 & field.moist==0, unique := "drought"]
fticr_pore_gather_trtsummary_c2[time.zero.saturation==0 & saturation==0 & drought==0 & field.moist==1, unique := "field_moist"]
# ninth, add 'site' column for when we bind later
fticr_pore_gather_trtsummary_c2$site="CPCRW"
#
setDT(fticr_pore_gather_trtsummary_d)[N>0, presence := "1"]
#
fticr_pore_gather_trtsummary_d2 = dcast(fticr_pore_gather_trtsummary_d, Mass+tension ~ treatment, value.var = "presence")
#
fticr_pore_gather_trtsummary_d2 %>%
replace(.,is.na(.),0) ->
fticr_pore_gather_trtsummary_d2
#
fticr_pore_gather_trtsummary_d2[,3:6] = sapply(fticr_pore_gather_trtsummary_d2[,3:6], as.numeric)
fticr_pore_gather_trtsummary_d2 = data.frame(fticr_pore_gather_trtsummary_d2)
#
### THERE ARE NO BASELINE DATA IN THIS DATASET. SO SUBTRACT TZSATURATION INSTEAD OF BASELINE.
# +1 = new molecule, -1 = lost molecule, 0 = molecule present or absent in treatment&baseline
fticr_pore_gather_trtsummary_d2 %>%
mutate(drought_new = drought - time.zero.saturation) %>%
mutate(saturation_new = saturation - time.zero.saturation) %>%
mutate(fieldmoist_new = field.moist - time.zero.saturation) ->
fticr_pore_gather_trtsummary_d2
#
setDT(fticr_pore_gather_trtsummary_d2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
fticr_pore_gather_trtsummary_d2[time.zero.saturation==0 & saturation==0 & drought==1 & field.moist==0, unique := "drought"]
fticr_pore_gather_trtsummary_d2[time.zero.saturation==0 & saturation==0 & drought==0 & field.moist==1, unique := "field_moist"]
#
fticr_pore_gather_trtsummary_d2$site="DWP"
#
setDT(fticr_pore_gather_trtsummary_s)[N>0, presence := "1"]
#
fticr_pore_gather_trtsummary_s2 = dcast(fticr_pore_gather_trtsummary_s, Mass+tension ~ treatment, value.var = "presence")
#
fticr_pore_gather_trtsummary_s2 %>%
replace(.,is.na(.),0) ->
fticr_pore_gather_trtsummary_s2
#
fticr_pore_gather_trtsummary_s2[,3:6] = sapply(fticr_pore_gather_trtsummary_s2[,3:6], as.numeric)
fticr_pore_gather_trtsummary_s2 = data.frame(fticr_pore_gather_trtsummary_s2)
#
### THERE ARE NO BASELINE DATA IN THIS DATASET. SO SUBTRACT TZSATURATION INSTEAD OF BASELINE.
# +1 = new molecule, -1 = lost molecule, 0 = molecule present or absent in treatment&baseline
fticr_pore_gather_trtsummary_s2 %>%
mutate(drought_new = drought - time.zero.saturation) %>%
mutate(saturation_new = saturation - time.zero.saturation) %>%
mutate(fieldmoist_new = field.moist - time.zero.saturation) ->
fticr_pore_gather_trtsummary_s2
#
setDT(fticr_pore_gather_trtsummary_s2)[time.zero.saturation==0 & saturation==1 & drought==0 & field.moist==0, unique := "saturation"]
fticr_pore_gather_trtsummary_s2[time.zero.saturation==0 & saturation==0 & drought==1 & field.moist==0, unique := "drought"]
fticr_pore_gather_trtsummary_s2[time.zero.saturation==0 & saturation==0 & drought==0 & field.moist==1, unique := "field_moist"]
#
fticr_pore_gather_trtsummary_s2$site="SR"
fticr_pore_new = rbind (fticr_pore_gather_trtsummary_c2,fticr_pore_gather_trtsummary_d2,fticr_pore_gather_trtsummary_s2)
## remove the presence/absence columns, they are now unnecessary
fticr_pore_new = data.frame(fticr_pore_new[,-c(3:6)])
fticr_pore_new[,3:5] = sapply(fticr_pore_new[,3:5], as.factor)
fticr_pore_new %>%
mutate(drought = case_when(
drought_new=="1"~"new",
drought_new=="-1"~"lost")) %>%
mutate(saturation = case_when(
saturation_new=="1"~"new",
saturation_new=="-1"~"lost")) %>%
mutate(field.moist = case_when(
fieldmoist_new=="1"~"new",
fieldmoist_new=="-1"~"lost"))  ->
fticr_pore_new
## subset only the character coding columns for new/lost
fticr_pore_new %>%
select("Mass","site","tension","saturation","field.moist","drought")->
fticr_pore_new2
## melt/gather into long-form. make new columns for treatment and newmolecules
fticr_pore_new2 = (fticr_pore_new2) %>%
gather(treatment, newmolecules,saturation:drought)
## remove NA
fticr_pore_new2 = fticr_pore_new2[complete.cases(fticr_pore_new2),]
fticr_pore_new3 = merge(fticr_pore_meta,fticr_pore_new2, by = "Mass")
## OUTPUT
write_csv(fticr_pore_new3, path = "fticr/fticr_pore_newmolecules.csv")
fticr_pore_unique = fticr_pore_new %>%
select("Mass","site","tension","unique")
## remove NA
fticr_pore_unique = fticr_pore_unique[complete.cases(fticr_pore_unique),]
fticr_pore_unique2 = merge(fticr_pore_meta, fticr_pore_unique, by = "Mass")
## OUTPUT
write_csv(fticr_pore_unique2, path = "fticr/fticr_pore_uniquemolecules.csv")
View(fticr_pore_unique2)
ggplot(fticr_pore_uniquemolecules[fticr_soil_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
geom_point()+
facet_wrap(~tension)+
theme_bw()+
theme(
legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW unique")
# 4d. unique molecules ----
fticr_pore_uniquemolecules = read_csv("fticr/fticr_pore_uniquemolecules.csv")
ggplot(fticr_pore_uniquemolecules[fticr_soil_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
geom_point()+
facet_wrap(~tension)+
theme_bw()+
theme(
legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW unique")
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
geom_point()+
facet_wrap(~tension)+
theme_bw()+
theme(
legend.position = "top",
legend.title = element_blank())+
ggtitle("CPCRW unique")
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique:CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="DWP",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="SR",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique_c=
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="CPCRW",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique:CPCRW")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique_d=
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="DWP",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: DWP")+
theme_bw()+
theme(
legend.position = "none",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique_s=
ggplot(fticr_pore_uniquemolecules[fticr_pore_uniquemolecules$site=="SR",],
aes(x = OC, y = HC, color = unique))+
facet_wrap(~tension)+
geom_point()+
xlim(0,1.25)+
ylim(0,3)+
ggtitle("unique: SR")+
theme_bw()+
theme(
legend.position = "bottom",
legend.title=element_blank(),
legend.text=element_text(size=12),
panel.border=element_rect(color="black",fill = NA, size=1.5),
axis.text=element_text(size=12,color="black"),
axis.title=element_text(size=14,color="black",face="bold")
)
gg_pore_vankrev_unique = plot_grid(gg_pore_vankrev_unique_c,
gg_pore_vankrev_unique_d,
gg_pore_vankrev_unique_s,
nrow = 3, align = "hv", axis = "bt")
save_plot("output/fticr_pore_vankrev_uniquemolecules.tiff",
gg_pore_vankrev_unique, base_width = 6, base_height = 12)
