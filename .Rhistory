knitr::kable(align = "r")
View(soil_relabund)
soil_relabund%>%
ungroup %>%
dplyr::mutate(sp = paste(treatment),
val = paste(relativeabundance)) %>%
dplyr::select(site, Class,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
View(soil_peaks)
soil_peaks %>%
ungroup %>%
dplyr::mutate(sp = paste(treatment),
val = paste(peaks_count)) %>%
select(site, Class,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
soil_peaks %>%
ungroup %>%
dplyr::mutate(sp = paste(treatment),
val = paste(peaks_count)) %>%
dplyr::select(site, Class,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
soil_relabund%>%
dplyr::mutate(Class = factor(Class, levels =
c("AminoSugar","Carb","Lipid","Protein","UnsatHC",
"ConHC","Lignin","Tannin","Unnamed")))->
soil_relabund
ungroup %>%
dplyr::mutate(sp = paste(treatment),
val = paste(relativeabundance)) %>%
dplyr::select(site, Class,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
soil_relabund%>%
dplyr::mutate(Class = factor(Class, levels =
c("AminoSugar","Carb","Lipid","Protein","UnsatHC",
"ConHC","Lignin","Tannin","Unnamed"))) %>%
ungroup %>%
dplyr::mutate(sp = paste(treatment),
val = paste(relativeabundance)) %>%
dplyr::select(site, Class,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
soil_peaks %>%
dplyr::mutate(Class = factor(Class, levels =
c("AminoSugar","Carb","Lipid","Protein","UnsatHC",
"ConHC","Lignin","Tannin","Unnamed","total"))) %>%
ungroup %>%
dplyr::mutate(sp = paste(treatment),
val = paste(peaks_count)) %>%
dplyr::select(site, Class,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
View(soil_unique)
View(soil_unique_peaks)
soil_unique %>%
dplyr::select(Mass,site,Class,unique) %>%
dplyr::mutate(Class = factor(Class, levels =
c("AminoSugar", "Carb","Lipid","Protein","UnsatHC",
"ConHC","Lignin","Tannin","Unnamed"))) %>%
drop_na %>%
group_by(site,Class,unique) %>%
dplyr::summarize(counts = n())->
soil_unique_counts
View(soil_unique_counts)
soil_unique_counts%>%
ungroup %>%
dplyr::mutate(sp = paste(unique),
val = paste(counts)) %>%
dplyr::select(site,Class,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
### create meta file ----
## sample data split by pore size (50 kPa and 1.5 kPa).
fticr_porewater %>%
dplyr::select(1:11) %>%
# remove compounds without class. har har.
filter(!Class=="None") %>%
# create new columns
dplyr::mutate(AImod = (1+C-(0.5*O)-S-(0.5*H))/(C-(0.5*O)-S-N-P),
NOSC =  4-(((4*C)+H-(3*N)-(2*O)-(2*S))/C),
HC = round(H/C,2),
OC = round(O/C,2))->
fticr_pore_meta
# create subset for HCOC and class
fticr_pore_meta %>%
dplyr::select(Mass, HC, OC, Class,NOSC)->
fticr_pore_meta_hcoc
# PART III: PROCESSING FOR OTHER ANALYSES ----
## a. NOSC -- soil ----
soil_meta_nosc <- fticr_soil_meta %>%
dplyr::select(Mass,NOSC)
## step 1: load the files ----
# data are split into (a) metadata and (b) sample data
# read_csv reads the zipped files without extracting
fticr_soil_meta = read_csv("data/FTICR_INPUT_SOIL_META.csv.zip")
fticr_soil_data = read_csv("data/FTICR_INPUT_SOIL_DATA.csv.zip")
corekey = read.csv("data/COREKEY.csv")
fticr_soil_meta %>%
# remove unnecessary columns
dplyr::select(-C13,-Error_ppm,-Candidates,-GFE,-bs1_class,-bs2_class) %>%
# rename columns
dplyr::rename(OC = OtoC_ratio,
HC = HtoC_ratio) %>%
filter(!Class=="Unassigned")->
fticr_soil_meta
# make a subset for just HCOC and class
fticr_soil_meta %>%
dplyr::select(Mass, Class, HC, OC) %>%
dplyr::mutate(HC = round(HC, 4),
OC = round(OC,4))->
fticr_meta_hcoc
# make a subset for relevant columns
### OUTPUT
# merge metadata with sample data
# ¿¿¿ do this later instead? YES
# fticr_soil = merge(fticr_soil_meta,fticr_soil_data,by = "Mass")
#
## step 2: clean and process ----
fticr_soil_data %>%
# melt/gather. transform from wide to long form
gather(core, intensity, C1:S25) %>% ## core = name of new categ column, intensity = name of values column, C1:C25 are columns that are collapsed
# remove all samples with zero intensity
filter(!intensity=="0") %>%
# merge with the core key file
left_join(corekey,by = "core") %>%
## now we need to filter only those peaks seen in 3 or more replicates
# add a column with no. of replicates
group_by(Mass,treatment,site) %>%
dplyr::mutate(reps = n()) %>%
# remove peaks seen in < 3 replicates
filter(reps>2) %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "Mass") %>%
# remove "unassigned" molecules
filter(!Class=="Unassigned")  ->
fticr_soil_raw_long
# used to be called:  `fticr_soil_gather2`
## now create a summary of this
fticr_soil_raw_long %>%
ungroup %>%
group_by(Mass,site,treatment) %>%
dplyr::summarize(intensity = mean(intensity)) %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "Mass") ->
fticr_soil_long
# PART II: FTICR DATA FOR POREWATER ----
## step 1: load the files ----
# the porewater file contains the Mass/Peak metadata as well as sample intensities data
fticr_porewater = read_csv("data/FTICR_INPUT_SOILPORE.csv.zip")
corekey = read.csv("data/COREKEY.csv")
# Create a file with the list of columns to drop.
# use the sample meta file for this. retain SampleType `sample` and `as`. (I don't know what `as` is.)
# metadata of sample information
pore_sample_meta = read.csv("data/FTICR_INPUT_SOILPORE_meta.csv")
pore_sample_meta %>%
filter(!Sample_Type=="sample") %>%
filter(!Sample_Type=="as") %>%
dplyr::rename(code = `X21T_CCS.2_Day8_1.C11_11Jan18_Leopard_Infuse.qb`) ->
# ^^^ rename the f-ing column. WTAF is this column name. Checked -- it's not because a row was moved up.
pore_sample_meta
write.csv(pore_sample_meta$code, "data/fticr_columns_to_drop2.txt", row.names = FALSE, quote = FALSE)
# drop unnecessary sample columns
drops <- readLines("data/fticr_columns_to_drop2.txt")
fticr_porewater[names(fticr_porewater) %in% drops] <- NULL
matches <- regexec("[0-9]-[A-Z][0-9]{1,2}", names(fticr_porewater))
matches_n <- unlist(matches)
lengths <- sapply(matches, function(x) attr(x, "match.length"))
# extract the part of the name we want and change
names <- substr(names(fticr_porewater), matches_n, matches_n + lengths - 1)
names(fticr_porewater)[matches_n > 0] <- names[matches_n > 0]
# remove addiitonal unnecessary names that couldn't be automated above
fticr_porewater %>%
dplyr::select(-`C13`,-`3use`,-`Error_ppm`)->
fticr_porewater
### create meta file ----
## sample data split by pore size (50 kPa and 1.5 kPa).
fticr_porewater %>%
dplyr::select(1:11) %>%
# remove compounds without class. har har.
filter(!Class=="None") %>%
# create new columns
dplyr::mutate(AImod = (1+C-(0.5*O)-S-(0.5*H))/(C-(0.5*O)-S-N-P),
NOSC =  4-(((4*C)+H-(3*N)-(2*O)-(2*S))/C),
HC = round(H/C,2),
OC = round(O/C,2))->
fticr_pore_meta
# create subset for HCOC and class
fticr_pore_meta %>%
dplyr::select(Mass, HC, OC, Class)->
fticr_pore_meta_hcoc
# PART III: PROCESSING FOR OTHER ANALYSES ----
## a. NOSC -- soil ----
soil_meta_nosc <- fticr_soil_meta %>%
dplyr::select(Mass,NOSC)
soil_nosc <- merge(fticr_soil_long,soil_meta_nosc, by="Mass")
pore_meta_nosc <- fticr_pore_meta %>%
dplyr::select(Mass,NOSC)
pore_nosc <- merge(fticr_pore_long,pore_meta_nosc, by="Mass")
#
### create data file ----
fticr_porewater %>%
dplyr::select(Mass, starts_with("5"), starts_with("1")) %>%
# collapse all core columns into a single column
melt(id="Mass") %>%
dplyr::rename(sample = variable,
intensity = value) %>%
# remove all peaks with intensity ==0
filter(!intensity==0) %>%
# using `sample` column, create columns for tension and core
dplyr::mutate(tension_temp = substr(sample,start=1,stop=1),
core = substr(sample,start=3,stop=7),
tension = case_when(
tension_temp=="1"~"1.5 kPa",
tension_temp=="5"~"50 kPa")) %>%
# remove unnecessary columns
dplyr::select(-tension_temp,-sample) %>%
# merge with the corekey and then remove NA containing rows
right_join(corekey, by = "core") %>%
drop_na->
temp_pore
# remove peaks seen in < 3 replicates
temp_pore %>%
group_by(Mass,tension,site,treatment) %>%
dplyr::mutate(reps = n()) %>%
filter(reps >2) %>%
# merge with hcoc file
left_join(fticr_pore_meta_hcoc, by = "Mass") %>%
drop_na->
fticr_pore_raw_long
# now create a summary by treatment
fticr_pore_raw_long %>%
group_by(Mass,tension,site,treatment) %>%
dplyr::summarise(intensity = mean(intensity)) %>%
# merge with hcoc file
left_join(fticr_pore_meta_hcoc, by = "Mass") %>%
drop_na->
fticr_pore_long
pore_nosc <- merge(fticr_pore_long,pore_meta_nosc, by="Mass")
soil_meta_nosc <- fticr_soil_meta %>%
dplyr::select(Mass,NOSC)
soil_nosc <- merge(fticr_soil_long,soil_meta_nosc, by="Mass")
### pore
pore_meta_nosc <- fticr_pore_meta %>%
dplyr::select(Mass,NOSC)
pore_nosc <- merge(fticr_pore_long,pore_meta_nosc, by="Mass")
### OUTPUT
write.csv(soil_nosc,FTICR_SOIL_NOSC,row.names = FALSE)
write.csv(pore_nosc,FTICR_PORE_NOSC,row.names = FALSE)
pore_nosc = read.csv(FTICR_PORE_NOSC)# <- "fticr/fticr_pore_nosc.csv"
soil_nosc = read.csv(FTICR_SOIL_NOSC)# <- "fticr/fticr_soil_nosc.csv"
soil_nosc %>%
mutate(treatment = factor(treatment,
levels = c("baseline","time zero saturation", "field moist","drought","saturation")))->
soil_nosc
View(soil_nosc)
ggplot(soil_nosc,
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
# scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#  scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,3000)+
facet_grid(site~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
ggplot(soil_nosc,
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
# scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#  scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,1000)+
facet_grid(site~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
pore_nosc %>%
mutate(treatment = factor(treatment,
levels = c("baseline","time zero saturation", "field moist","drought","saturation")))->
pore_nosc
#CPCRW
ggplot(pore_nosc[pore_nosc$site=="CPCRW" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,3000)+
ggtitle("CPCRW")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
#CPCRW
ggplot(pore_nosc[pore_nosc$site=="CPCRW" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,1000)+
ggtitle("CPCRW")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
#DWP
ggplot(pore_nosc[pore_nosc$site=="DWP" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,3000)+
ggtitle("DWP")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
#DWP
ggplot(pore_nosc[pore_nosc$site=="DWP" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,1000)+
ggtitle("DWP")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
#SR
ggplot(pore_nosc[pore_nosc$site=="SR" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,1000)+
ggtitle("SR")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
#SR
ggplot(pore_nosc[pore_nosc$site=="SR" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,300)+
ggtitle("SR")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
#DWP
ggplot(pore_nosc[pore_nosc$site=="DWP" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,300)+
ggtitle("DWP")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
#CPCRW
ggplot(pore_nosc[pore_nosc$site=="CPCRW" &!pore_nosc$treatment=="baseline",],
aes(x = NOSC, fill = treatment, color = treatment))+
geom_histogram(binwidth = 0.10, position = "identity", alpha = 0.2)+
#scale_fill_brewer(palette = "Dark2")+
scale_color_brewer(palette = "Dark2")+
scale_fill_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
scale_color_manual(values = c("#666666","#1B9E77", "#D95F02", "#7570B3"))+
#geom_histogram(data = subset(fticr_pore_nosc, site = "CPCRW" | treatment=="field moist"), fill = "red", alpha = 0.2)+
xlim(-2.5, 2.5)+
ylim(0,300)+
ggtitle("CPCRW")+
facet_grid(tension~treatment)+ #facet with two variables
theme_bw()+
theme_kp()
charac %>%
dplyr::mutate(variable = factor(variable, levels = c("TC_perc", "TN_perc", "TOC_perc", "WSOC_mg_g",
"Ca_meq100g", "Mg_meq100g",
"pH", "EC_dS_m",
"Sand_perc", "Silt_perc", "Clay_perc"))) %>%
ungroup %>%
dplyr::mutate(sp = paste(site),
val = paste(summary_hsd)) %>%
dplyr::select(variable,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
ggplot(pore,aes(x = pore_size, y=freq,color = site))+
geom_line(size = 1)+
scale_color_brewer(palette = "Set2")+
#geom_density(adjust=0.5)+
labs (y = expression (bold ("distribution, %"),
x = expression (bold ("pore size" ))))+
theme_bw()+
theme_kp()
water_retention = read_excel("data/water_retention.xlsx")
# van genuchten plots
ggplot()+
geom_line(data = water_retention,aes(x = Tension_c, y = CPCRW_water_VG, color = "CPCRW"), size=1)+
geom_line(data = water_retention,aes(x = Tension_d, y = DWP_water_VG,color = "DWP"), size=1)+
geom_line(data = water_retention,aes(x = Tension_s, y = SR_water_VG,color = "SR"), size=1)+
annotate("text", label = "DWP, fine sand", x = 25, y = 0.03,size=4,fontface="bold")+
annotate("text", label = "CPCRW, silt loam", x = 75, y = 0.13,size=4,fontface="bold")+
annotate("text", label = "SR, silty clay loam", x = 55, y = 0.3,size=4,fontface="bold")+
labs (y = expression (bold ("volumetric moisture content")),
x = expression (bold ("tension, kPa" )))+
ylim(0,0.6)+
theme_bw()+
theme_kp()+
theme (legend.position = "none")
wsoc_pore %>%
ungroup %>%
dplyr::mutate(sp = paste(Suction, Site),
val = paste(wsoc_dunnett)) %>%
select(Treatment,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
wsoc_pore %>%
ungroup %>%
dplyr::mutate(sp = paste(Suction, Site),
val = paste(wsoc_dunnett)) %>%
dplyr::select(Treatment,sp, val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
View(pore_nosc)
pore_nosc %>%
group_by(tension,site,treatment) %>%
dplyr::summarise(median = median(nosc))->
pore_nosc_median
pore_nosc %>%
group_by(tension,site,treatment) %>%
dplyr::summarise(median = median(NOSC))->
pore_nosc_median
View(pore_nosc_median)
pore_nosc_median %>%
dplyr::mutate(sp = paste(tention, treatment),
val = median) %>%
select(site,sp,val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
pore_nosc_median %>%
dplyr::mutate(sp = paste(tension, treatment),
val = median) %>%
select(site,sp,val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
pore_nosc_median %>%
dplyr::mutate(sp = paste(tension, treatment),
val = median) %>%
dplyr::select(site,sp,val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
pore_nosc_median %>%
dplyr::mutate(sp = paste(treatment),
val = median) %>%
dplyr::select(tension,site,sp,val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
soil_nosc %>%
group_by(site,treatment) %>%
dplyr::summarise(median = median(NOSC))->
soil_nosc_median
soil_nosc_median %>%
dplyr::mutate(sp = paste(treatment),
val = median) %>%
dplyr::select(site,sp,val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
pore_nosc_median %>%
dplyr::mutate(sp = paste(treatment),
val = round(median,4)) %>%
dplyr::select(tension,site,sp,val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
soil_nosc_median %>%
dplyr::mutate(sp = paste(treatment),
val = round(median,4)) %>%
dplyr::select(site,sp,val) %>%
spread(sp, val) %>%
knitr::kable(align = "r")
