dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = sum(Additional_Wt_toRemove,DryMass_NONsoil_ALL_g,na.rm = TRUE)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g, na.rm = T,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
# group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = sum(Additional_Wt_toRemove,DryMass_NONsoil_ALL_g,na.rm = TRUE)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
# group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace(is.na(.),0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = sum(Additional_Wt_toRemove,DryMass_NONsoil_ALL_g,na.rm = TRUE)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
# group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace(is.na(.),0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
# group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve2, aes(x = Start_Date_Time2, y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
ggplot(valve3, aes(x = Start_Date_Time2, y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
ggplot(valve3, aes(x = as.numeric(Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 = which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 == which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
#group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 == which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 == which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(.,0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 == which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace_na(0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 == which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace(is.na(.),0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
#group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == which.max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace(is.na(.),0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
which.max(Start_Date_Time2)
which.max(valve3$Start_Date_Time2)
max(valve3$Start_Date_Time2)
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
group_by(Site, SampleID, Treatment) %>%
dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace(is.na(.),0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
#group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace(is.na(.),0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
source("0-packages.R")
key = read.csv("moisture/3Soils_CPCRW_SR_DWP_PicarroLog - sampleID_key.csv")
valve = read.csv("moisture/3Soils_CPCRW_SR_DWP_PicarroLog - valve_map.csv")
key %>%
dplyr::select(SampleID,Site,CoreNo,Treatment,DryMass_SoilOnly_g,DryMass_NONsoil_ALL_g)->
key2
valve %>%
dplyr::filter(stringr::str_detect(TREATMENT_PHASE,c("DROUGHT_INCUBATION","FIELD_MOIST_INCUBATION","SATURATION_INCUBATION")),
!stringr::str_detect(Ignore_Data,"Y"))->
valve2
valve2 %>%
filter(!Treatment=="ambient") %>%
mutate(Start_Date_Time2 = as.POSIXct(strptime(valve2$Start_Date_Time,format = "%m/%d/%Y %H:%M", tz = "America/Los_Angeles")),
Additional_Wt_toRemove = as.numeric(Additional_Wt_toRemove))%>%
#group_by(Site, SampleID, Treatment) %>%
#dplyr::filter(Start_Date_Time2 == max(Start_Date_Time2)) %>%
#dplyr::select(1:6) %>%
left_join(key2, by = c("SampleID","Site","Treatment")) %>%
replace(is.na(.),0) %>%
dplyr::rename(total_g = Total_core_mass_pot_pie_pans_g,
drysoil_g = DryMass_SoilOnly_g) %>%
dplyr::mutate(total_g=as.numeric(as.character(total_g)),
nonsoil_g = (Additional_Wt_toRemove+DryMass_NONsoil_ALL_g)) %>%
#dplyr::select(1:4,total_g,drysoil_g,nonsoil_g) %>%
#drop_na %>%
dplyr::mutate(moistsoil_g = total_g - nonsoil_g,
water_g = moistsoil_g - drysoil_g,
moisture_perc = (water_g/drysoil_g)*100)->
valve3
names(valve3)
ggplot(valve3, aes(x = (Start_Date_Time2), y = moisture_perc))+
geom_point()+
facet_grid(Site~Treatment)
## step 1: load the files ----
# data are split into (a) metadata and (b) sample data
# read_csv reads the zipped files without extracting
fticr_soil_meta = read_csv("data/FTICR_INPUT_SOIL_META.csv.zip")
source("0-packages.R")
## step 1: load the files ----
# data are split into (a) metadata and (b) sample data
# read_csv reads the zipped files without extracting
fticr_soil_meta = read_csv("data/FTICR_INPUT_SOIL_META.csv.zip")
fticr_soil_data = read_csv("data/FTICR_INPUT_SOIL_DATA.csv.zip")
corekey = read.csv("data/COREKEY.csv")
fticr_soil_meta %>%
# remove unnecessary columns
dplyr::select(-C13,-Error_ppm,-Candidates,-GFE,-bs1_class,-bs2_class) %>%
# rename columns
dplyr::rename(OC = OtoC_ratio,
HC = HtoC_ratio) %>%
filter(!Class=="Unassigned")->
fticr_soil_meta
names(fticr_soil_meta)
# make a subset for just HCOC and class
fticr_soil_meta %>%
dplyr::select(Mass, MolForm, Class, HC, OC) %>%
dplyr::mutate(HC = round(HC, 4),
OC = round(OC,4))->
fticr_meta_hcoc
#
## step 2: clean and process ----
fticr_soil_data %>%
# melt/gather. transform from wide to long form
gather(core, intensity, C1:S25) %>% ## core = name of new categ column, intensity = name of values column, C1:C25 are columns that are collapsed
# remove all samples with zero intensity
filter(!intensity=="0") %>%
# merge with the core key file
left_join(corekey,by = "core") %>%
## now we need to filter only those peaks seen in 3 or more replicates
# add a column with no. of replicates
group_by(MolForm,treatment,site) %>%
dplyr::mutate(reps = n()) %>%
# remove peaks seen in < 3 replicates
filter(reps>2) %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "Mass") %>%
# remove "unassigned" molecules
filter(!Class=="Unassigned")  ->
fticr_soil_raw_long
names(fticr_soil_data)
#
## step 2: clean and process ----
fticr_soil_data %>%
# melt/gather. transform from wide to long form
gather(core, intensity, C1:S25) %>% ## core = name of new categ column, intensity = name of values column, C1:C25 are columns that are collapsed
# remove all samples with zero intensity
filter(!intensity=="0") %>%
# merge with the core key file
left_join(corekey,by = "core") %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "Mass") %>%
## now we need to filter only those peaks seen in 3 or more replicates
# add a column with no. of replicates
group_by(MolForm,treatment,site) %>%
dplyr::mutate(reps = n()) %>%
# remove peaks seen in < 3 replicates
filter(reps>2) %>%
# remove "unassigned" molecules
filter(!Class=="Unassigned")  ->
fticr_soil_raw_long
View(fticr_soil_raw_long)
## now create a summary of this
fticr_soil_raw_long %>%
ungroup %>%
group_by(MolForm,site,treatment) %>%
dplyr::summarize(intensity = mean(intensity)) %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "Mass") ->
fticr_soil_long
## now create a summary of this
fticr_soil_raw_long %>%
ungroup %>%
group_by(MolForm,site,treatment) %>%
dplyr::summarize(intensity = mean(intensity)) %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "MolForm") ->
fticr_soil_long
View(fticr_soil_long)
gg_vankrev(fticr_soil_long, aes(x = OC, y = HC, color = treatment))+
facet_grid(site~treatment)
gg_vankrev(na.omit(fticr_soil_long), aes(x = OC, y = HC, color = treatment))+
facet_grid(site~treatment)
gg_vankrev(na.omit(fticr_soil_long), aes(x = OC, y = HC, color = treatment))+
facet_grid(site~treatment)
?diff
# calculate number of unassigned peaks
fticr_soil_data %>%
# melt/gather. transform from wide to long form
gather(core, intensity, C1:S25) %>% ## core = name of new categ column, intensity = name of values column, C1:C25 are columns that are collapsed
# remove all samples with zero intensity
filter(!intensity=="0") %>%
# merge with the core key file
left_join(corekey,by = "core") %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "Mass") %>%
## now we need to filter only those peaks seen in 3 or more replicates
# add a column with no. of replicates
group_by(MolForm,treatment,site) %>%
dplyr::mutate(reps = n()) %>%
# remove peaks seen in < 3 replicates
filter(reps>2) %>%
# remove "unassigned" molecules
filter(Class=="Unassigned")  ->
raw_unassigned
View(raw_unassigned)
View(fticr_soil_data)
# calculate number of unassigned peaks
fticr_soil_data %>%
# melt/gather. transform from wide to long form
gather(core, intensity, C1:S25) %>% ## core = name of new categ column, intensity = name of values column, C1:C25 are columns that are collapsed
# remove all samples with zero intensity
filter(!intensity=="0") %>%
# merge with the core key file
left_join(corekey,by = "core") %>%
# merge with hcoc file
left_join(fticr_meta_hcoc, by = "Mass") %>%
## now we need to filter only those peaks seen in 3 or more replicates
# add a column with no. of replicates
group_by(MolForm,treatment,site) %>%
dplyr::mutate(reps = n()) %>%
# remove peaks seen in < 3 replicates
filter(reps>2) %>%
ungroup %>%
group_by(site, treatment, Class) %>%
dplyr::summarise(n=n())->
# remove "unassigned" molecules
#filter(Class=="Unassigned")  ->
raw_unassigned
View(raw_unassigned)
View(fticr_meta_hcoc)
levels(fticr_soil_meta$Class)
levels(fticr_meta_hcoc$Class)
level(fticr_meta_hcoc$Class)
levels(fticr_meta_hcoc$Class)
str(fticr_meta_hcoc$Class)
levels(as.factor(fticr_meta_hcoc$Class))
