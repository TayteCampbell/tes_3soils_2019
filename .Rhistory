P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(!is.na(mol_C),!is.na(mol_H),!is.na(mol_N),!is.na(mol_O),!is.na(mol_S),!is.na(mol_Na)))->temp
View(temp)
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na))->temp
View(temp)
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na)) %>%
str_replace_all("NA","")->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na)) %>%
str_replace("NA","")->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace(MoLForm,"NA","")) ->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace(MolForm,"NA","")) ->temp
View(temp)
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace(MolForm,NA,"")) ->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm2 = str_replace(MolForm,"NA","")) ->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm2 = str_replace_all(MolForm,"NA","")) ->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace_all(MolForm,"NA","")) ->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace_all(MolForm,"NA","")) %>%
dplyr::select(Mass,MolForm)->temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace_all(MolForm,"NA","")) %>%
dplyr::select(Mass,MolForm) %>%
left_join(fticr_pore_meta, by = "Mass")->fticr_pore_meta2
View(fticr_pore_meta2)
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace_all(MolForm,"NA","")) %>%
dplyr::select(Mass,MolForm) %>%
left_join(fticr_pore_meta, by = "Mass")->fticr_pore_meta
# create subset for HCOC and class
fticr_pore_meta %>%
dplyr::select(Mass, MolForm,HC, OC, Class)->
fticr_pore_meta_hcoc
View(fticr_pore_meta_hcoc)
#
### create data file ----
fticr_porewater %>%
dplyr::select(MolForm, starts_with("5"), starts_with("1")) %>%
# collapse all core columns into a single column
melt(id="MolForm") %>%
dplyr::rename(sample = variable,
intensity = value) %>%
# remove all peaks with intensity ==0
filter(!intensity==0) %>%
# using `sample` column, create columns for tension and core
dplyr::mutate(tension_temp = substr(sample,start=1,stop=1),
core = substr(sample,start=3,stop=7),
tension = case_when(
tension_temp=="1"~"1.5 kPa",
tension_temp=="5"~"50 kPa")) %>%
# remove unnecessary columns
dplyr::select(-tension_temp,-sample) %>%
# merge with the corekey and then remove NA containing rows
right_join(corekey, by = "core") %>%
drop_na->
temp_pore
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace_all(MolForm,"NA","")) %>%
dplyr::select(Mass,MolForm)->molform_temp
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace_all(MolForm,"NA","")) %>%
dplyr::select(Mass,MolForm)->molform_temp
### create meta file ----
## sample data split by pore size (50 kPa and 1.5 kPa).
fticr_porewater %>%
dplyr::select(1:11) %>%
# remove compounds without class. har har.
filter(!Class=="None") %>%
# create new columns
dplyr::mutate(AImod = (1+C-(0.5*O)-S-(0.5*H))/(C-(0.5*O)-S-N-P),
NOSC =  4-(((4*C)+H-(3*N)-(2*O)-(2*S))/C),
HC = round(H/C,2),
OC = round(O/C,2))->
fticr_pore_meta
#### calculate molecular formula
fticr_pore_meta %>%
dplyr::select(1:8) %>%
dplyr::mutate(mol_C = case_when(C==1 ~ paste("C"),
C>1 ~ paste0("C",C),
C==0 ~ NA_character_),
mol_H = case_when(H==1 ~ paste("H"),
H>1 ~ paste0("H",H),
H==0 ~ NA_character_),
mol_O = case_when(O==1 ~ paste("O"),
O>1 ~ paste0("O",O),
O==0 ~ NA_character_),
mol_N = case_when(N==1 ~ paste("N"),
N>1 ~ paste0("N",N),
N==0 ~ NA_character_),
mol_S = case_when(S==1 ~ paste("S"),
S>1 ~ paste0("S",S),
S==0 ~ NA_character_),
mol_P = case_when(P==1 ~ paste("P"),
P>1 ~ paste0("P",P),
P==0 ~ NA_character_),
mol_Na = case_when(Na==1 ~ paste("Na"),
Na>1 ~ paste0("Na",Na),
Na==0 ~ NA_character_),
MolForm = paste0(mol_C,mol_H,mol_N,mol_O,mol_S,mol_Na),
MolForm = str_replace_all(MolForm,"NA","")) %>%
dplyr::select(Mass,MolForm)->molform_temp
molform_temp%>%
left_join(fticr_pore_meta, by = "Mass")->fticr_pore_meta
# create subset for HCOC and class
fticr_pore_meta %>%
dplyr::select(Mass, MolForm,HC, OC, Class)->
fticr_pore_meta_hcoc
#
### create data file ----
fticr_porewater %>%
left_join(molform_temp, by = "Mass") %>%
dplyr::select(MolForm, starts_with("5"), starts_with("1")) %>%
# collapse all core columns into a single column
melt(id="MolForm") %>%
dplyr::rename(sample = variable,
intensity = value) %>%
# remove all peaks with intensity ==0
filter(!intensity==0) %>%
# using `sample` column, create columns for tension and core
dplyr::mutate(tension_temp = substr(sample,start=1,stop=1),
core = substr(sample,start=3,stop=7),
tension = case_when(
tension_temp=="1"~"1.5 kPa",
tension_temp=="5"~"50 kPa")) %>%
# remove unnecessary columns
dplyr::select(-tension_temp,-sample) %>%
# merge with the corekey and then remove NA containing rows
right_join(corekey, by = "core") %>%
drop_na->
temp_pore
View(temp_pore)
# remove peaks seen in < 3 replicates
temp_pore %>%
group_by(MolForm,tension,site,treatment) %>%
dplyr::mutate(reps = n()) %>%
filter(reps >2) %>%
# merge with hcoc file
left_join(fticr_pore_meta_hcoc, by = "MolForm") %>%
drop_na->
fticr_pore_raw_long
View(fticr_pore_raw_long)
# now create a summary by treatment
fticr_pore_raw_long %>%
group_by(MolForm,tension,site,treatment) %>%
dplyr::summarise(intensity = mean(intensity)) %>%
# merge with hcoc file
left_join(fticr_pore_meta_hcoc, by = "MolForm") %>%
drop_na->
fticr_pore_long
View(fticr_pore_long)
### FTICR-PORE OUTPUT ----
write.csv(fticr_pore_meta, FTICR_PORE_META, row.names = FALSE)
write.csv(fticr_pore_long, FTICR_PORE_LONG,row.names = FALSE)
write.csv(fticr_pore_raw_long, FTICR_PORE_RAW_LONG,row.names = FALSE)
# PART III: PROCESSING FOR OTHER ANALYSES ----
## a. NOSC  ----
### soil
soil_meta_nosc <- fticr_soil_meta %>%
dplyr::select(MolForm,NOSC)
soil_nosc <- merge(fticr_soil_long,soil_meta_nosc, by="MolForm")
View(soil_nosc)
pore_meta_nosc <- fticr_pore_meta %>%
dplyr::select(MolForm,NOSC)
pore_nosc <- merge(fticr_pore_long,pore_meta_nosc, by="MolForm")
### OUTPUT
write.csv(soil_nosc,FTICR_SOIL_NOSC,row.names = FALSE)
write.csv(pore_nosc,FTICR_PORE_NOSC,row.names = FALSE)
